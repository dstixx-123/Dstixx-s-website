"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="22eb51e7-c782-5bef-a346-7b41dbc38d14")}catch(e){}}();
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[5817],{282688:(e,a,t)=>{t.d(a,{AX:()=>E,Ay:()=>u,DA:()=>v,DD:()=>s,Fz:()=>g,IC:()=>x,MV:()=>m,Ns:()=>y,O2:()=>d,QW:()=>T,Vw:()=>h,Vz:()=>r,dd:()=>c,eX:()=>o,fH:()=>p,hL:()=>f,ho:()=>i,jO:()=>N,ns:()=>A,r_:()=>_,rf:()=>n,yl:()=>l});let l="autosave_modal--modal--Egqg3",s="autosave_modal--title--Q-T-o",n="autosave_modal--body--pv4yP",o="autosave_modal--fileRows--JQWy9",i="autosave_modal--fileRow--vBNLB",c="autosave_modal--userRows--fG3Qq",r="autosave_modal--onlyFileRow--yr2jI autosave_modal--fileRow--vBNLB autosave_modal--body--pv4yP",m="autosave_modal--onlyFileRowText--NGT-7",d="autosave_modal--userTitle--lEP2M ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd",u="autosave_modal--fileMetadata--JIecy",v="autosave_modal--fileTitle--L9HsU ellipsis--ellipsis--Tjyfa",f="autosave_modal--fileLastUpdatedAt--ZL15q ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd",E="autosave_modal--logOutButtons--961-N",_="autosave_modal--logOutDiscard--MvTW-",g="autosave_modal--logOutDone--cjhVr autosave_modal--flexRowEnd--UaYDp",y="autosave_modal--doneAndSync---UvWx autosave_modal--flexRowEnd--UaYDp",N="autosave_modal--expiryAndDone--ck-oP",h="autosave_modal--done--F-hm3",p="autosave_modal--expiryWrapper--1Ee1U",x="autosave_modal--expiry--E2Ybr",T="autosave_modal--warningIcon--T1wLu",A="autosave_modal--openToSync--KQUfj"},275081:(e,a,t)=>{t.r(a),t.d(a,{AutosaveLearnMoreModal:()=>d});var l=t(411855),s=t(188507),n=t(799569),o=t(946689),i=t(939863),c=t(662275),r=t(488578),m=t(282688);function d({userInOrg:e}){let a=(0,s.wA)();return l.createElement(r.aF,{className:m.yl},l.createElement(n.s_,{dispatch:a}),l.createElement("div",{className:m.DD},l.createElement(i.Tx,{id:"autosave.learn_more.title"})),l.createElement("div",{className:m.rf},l.createElement(i.Tx,{id:"autosave.learn_more.body_save_pending_changes"})),l.createElement("div",{className:m.rf},l.createElement(i.Tx,{id:"autosave.learn_more.body_use_version_history"})),l.createElement("div",{className:m.Fz},l.createElement(o.nR,{onClick:()=>{a(c.Ce())},className:m.Vw},l.createElement(i.Tx,{id:"autosave.learn_more.done_button"}))))}},714932:(e,a,t)=>{t.r(a),t.d(a,{AutosaveLogOutModal:()=>K,HasAutosaveChangesModal:()=>W});var l=t(411855),s=t(188507),n=t(677469),o=t.n(n),i=t(717068),c=t(297666),r=t(517333),m=t(737947),d=t(776621),u=t(304783),v=t(799569),f=t(946689),E=t(564577),_=t(574176),g=t(442325),y=t(89161),N=t(869381),h=t(762638),p=t(939863),x=t(119198),T=t(662275),A=t(788811),w=t(823699),D=t(63104),k=t(132367),F=t(860178),b=t(132135),C=t(565167),O=t(945020),L=t(754168),M=t(488578),R=t(282688),S=t(247866);function U(e){return e.user?l.createElement("div",{className:R.O2},l.createElement("p",null,e.user.community_profile_handle||e.user.email)):null}async function j(e,a){let t=!1,l=null;try{let{data:s}=await L.S.getFiles({includePerms:!0,fileKey:a.fileKey,args:{headers:{"X-Figma-User-ID":e}}});(l=s.meta)&&(l.deleted_at||!l.can_edit_canvas)&&(t=!0)}catch(e){404===e.status?t=!0:(0,d.Lo)("Autosave","Failed to retrieve information about autosave file")}return{userID:e,shouldDeleteFile:t,unsyncedFile:a,figFile:l}}let B=(e,a)=>(0,c.s)(()=>{let t=new URL((0,b.r1)(e,!0));t.searchParams.append("fuid",a),m.Ay.redirect(t.toString(),"_blank")}),z=(e,a)=>(0,c.s)(()=>e(x.NA({file:a,openNewFileIn:O.ai.NEW_TAB,source:C.U.AUTOSAVE_MODAL})));function V(e,a,t){return(0,D.y8)(a)?{fileName:a.file.name,onClick:B(a.file,t.id),thumbnail:l.createElement(g.H,{file:a.file,size:N.y.SMALL,borderRadius:4})}:{fileName:a.name,onClick:z(e,a),thumbnail:l.createElement(y.A,{listView:"slightly-larger"})}}function P(e){let{fileName:a,onClick:t,thumbnail:n}=V((0,s.wA)(),e.fileState,e.user);return l.createElement("div",{className:R.ho,key:e.fileState.fileKey},l.createElement("div",{className:h.cx.hFull.$},n),l.createElement("div",{className:R.Ay},l.createElement("div",{className:R.DA},a),l.createElement("div",{className:R.hL},l.createElement(p.Tx,{id:"tile.file_tile.edited_time",time:l.createElement(E.h1,{date:e.fileState.lastUpdatedAt})}))),l.createElement(f.nR,{className:R.ns,onClick:t},l.createElement(p.Tx,{id:"autosave.has_changes.open_to_sync"})))}function G(e){return l.createElement("div",{className:R.dd},Object.keys(e.files).map(a=>l.createElement("div",{key:a,className:R.eX},l.createElement(U,{user:e.users.filter(e=>(null==e?void 0:e.id)===a)[0]}),l.createElement("div",null,Object.values(e.files[a]).map(t=>l.createElement(P,{fileState:t,user:e.users.filter(e=>(null==e?void 0:e.id)===a)[0],key:t.fileKey}))))))}function I(e,a,t,s,n,i){let c;let r=i||(()=>{e(T.Ce())}),m=H(t),d=1===o()(Object.values(a)).length,u=null,E=null,g=null,y=null,N=null;if(d){u=o()(Object.values(a))[0];let t=Object.keys(a).filter(e=>a[e].length>0)[0],n=V(e,u,E=s.filter(e=>(null==e?void 0:e.id)===t)[0]);g=n.fileName,y=n.onClick,N=n.thumbnail,c=l.createElement("div",null,l.createElement(U,{user:E}),l.createElement("div",{className:R.Vz},l.createElement("div",{className:h.cx.hFull.$},N),l.createElement("div",{className:R.MV},l.createElement(p.Tx,{id:"autosave.has_changes.unsaved_changes_to_file",fileName:l.createElement("span",{className:R.DD},g)}))))}else c=l.createElement("div",null,l.createElement("div",{className:R.rf},l.createElement(p.Tx,{id:"autosave.has_changes.unsynced_changes_offline"})),l.createElement(G,{files:a,users:s}));return l.createElement(M.aF,{className:R.yl,size:500,tintedModalBackground:!0},l.createElement(v.s_,{dispatch:e}),l.createElement("div",{className:R.DD},l.createElement(p.Tx,{id:"autosave.has_changes.sync_offline_changes"})),c,m||n||d?l.createElement("div",{className:R.jO},m&&l.createElement("div",{className:R.fH},l.createElement(_.B,{svg:S.A,className:R.QW}),l.createElement("div",{className:R.IC},m)),l.createElement("div",{className:R.Ns},n?l.createElement(f.nR,{onClick:r},l.createElement(p.Tx,{id:"autosave.has_changes.dismiss.later"})):null,d&&y&&l.createElement(f.$$,{onClick:y},l.createElement(p.Tx,{id:"autosave.has_changes.open_to_sync"})))):null)}function W(){let e=(0,s.wA)(),{unsyncedFiles:a,localUnsyncedFiles:t}=(0,A.Gg)(),l=(0,s.d4)(e=>e.modalShown),n=(0,s.d4)(e=>e.autosave.nextGarbageCollectionTimestamp),o=(0,F.iZ)(),i=null==o?void 0:o.id;return l&&i&&o?I(e,{[i]:[...a,...t]},n,[o],!0):null}function $(e){let a=(0,s.wA)(),[t,n]=l.useState(!1),[o,i]=l.useState(!1),c=async()=>{try{for(let a of e.users){let e=null==a?void 0:a.id;e&&await (0,A.go)((0,w.cu)(e))}}finally{i(!0)}},m=()=>{n(!0)};if(o)return l.createElement(M.aF,{className:R.yl,size:384,tintedModalBackground:!0},l.createElement(v.s_,{dispatch:a}),l.createElement("div",{className:R.DD},l.createElement(p.Tx,{id:"autosave.logout.offline_changes"})),l.createElement("div",{className:R.rf},l.createElement(p.Tx,{id:"autosave.logout.offline_changes_discarded"})),l.createElement("div",{className:R.Vw},l.createElement(f.nR,{onClick:e.onLogOut},l.createElement(p.Tx,{id:"autosave.logout.log_out"}))));if(0===Object.values(e.files).length&&e.loaded)return l.createElement(M.aF,{className:R.yl,size:384,tintedModalBackground:!0},l.createElement(v.s_,{dispatch:a}),l.createElement("div",{className:R.DD},l.createElement(p.Tx,{id:"autosave.logout.offline_changes"})),l.createElement("div",{className:R.rf},l.createElement(p.Tx,{id:"autosave.logout.offline_changes_synced"})),l.createElement("div",{className:R.Vw},l.createElement(f.nR,{onClick:e.onLogOut},l.createElement(p.Tx,{id:"autosave.logout.log_out"}))));if(t)return I(a,e.files,e.nextGarbageCollectionTimestamp,e.users,!1,()=>{n(!1)});{let t;let s=r.eD?(0,p.t)("autosave.logout.log_out_text.desktop"):(0,p.t)("autosave.logout.log_out_text.web");return t=r.eD?l.createElement("div",{className:R.AX},l.createElement("div",{className:R.r_},l.createElement(f.s6,{onClick:c},l.createElement(p.Tx,{id:"autosave.logout.discard_and_logout"}))),l.createElement("div",{className:R.Fz},l.createElement(f.nR,{onClick:()=>{a(T.Lo())}},l.createElement(p.Tx,{id:"autosave.logout.cancel"})),l.createElement(f.nR,{onClick:m},l.createElement(p.Tx,{id:"autosave.logout.show_changes"})))):l.createElement("div",{className:R.AX},l.createElement("div",{className:R.r_},l.createElement(f.s6,{onClick:c},l.createElement(p.Tx,{id:"autosave.logout.discard"}))),l.createElement("div",{className:R.Fz},l.createElement(f.nR,{onClick:e.onLogOut},l.createElement(p.Tx,{id:"autosave.logout.log_out"})),l.createElement(f.$$,{onClick:m},l.createElement(p.Tx,{id:"autosave.logout.sync_changes"})))),l.createElement(M.aF,{className:R.yl,size:424,tintedModalBackground:!0},l.createElement(v.s_,{dispatch:a}),l.createElement("div",{className:R.DD},l.createElement(p.Tx,{id:"autosave.has_changes.sync_offline_changes"})),l.createElement("div",{className:R.rf},s),t)}}function K(e){let{multiUserUnsyncedFiles:a,multiUserGarbageCollectionTimestamp:t,loaded:n,autosaveFilesToDelete:o}=function(e){let a=(0,s.wA)(),[t,n]=l.useState({multiUserGarbageCollectionTimestamp:0,multiUserUnsyncedFiles:{},loaded:!1,autosaveFilesToDelete:[]});return l.useEffect(()=>{let a=async()=>{try{let a=await (0,A.ZW)((0,i.WI)(e.map(e=>null==e?void 0:e.id))),t={},l=[],s=[];for(let[e,l]of Object.entries(a)){for(let a of l.unsyncedFiles)s.push(j(e,a));for(let a of l.newFiles)e in t||(t[e]=[]),t[e].push(a)}for(let e of(await Promise.all(s))){let a=e.userID;e.shouldDeleteFile?l.push({userID:a,fileKey:e.unsyncedFile.fileKey}):e.figFile&&(a in t||(t[a]=[]),t[a].push({type:"autosave-file",fileKey:e.figFile.key,lastUpdatedAt:e.unsyncedFile.lastUpdatedAt,file:e.figFile}))}let o=Math.min(...Object.values(a).map(e=>e.nextGarbageCollectionTimestamp));n({multiUserGarbageCollectionTimestamp:o,multiUserUnsyncedFiles:t,loaded:!0,autosaveFilesToDelete:l})}catch(e){e instanceof Error?((0,d.x1)("Autosave","Failed to call autosave callback",{name:e.name,message:e.message}),(0,d.$D)(u.e.SCENEGRAPH_AND_SYNC,e)):(0,d.$D)(u.e.SCENEGRAPH_AND_SYNC,Error("Failed to call autosave callback"))}};return k.hp.register(k.a,a),a(),function(){k.hp.unregister(k.a,a)}},[a,e]),t}(e.users);return(0,F.TA)()?l.createElement($,{loaded:n,nextGarbageCollectionTimestamp:t,files:a,onLogOut:()=>{for(let e of o)(0,A.go)((0,w.Zt)(e.userID,e.fileKey)).catch(e=>{(0,d.$D)(u.e.UNOWNED,Error("Failed to delete autosave data for sessions"))});e.onLogOut()},users:e.users}):null}W.displayName="HasAutosaveChangesModal";let H=e=>{let a=Math.floor(((0,A.bD)()-(Date.now()-e))/864e5);return a>5?null:a<1?l.createElement(p.Tx,{id:"autosave.has_changes.expiry_text_shortly"}):l.createElement(p.Tx,{id:"autosave.has_changes.expiry_text_days",days:a})};K.displayName="AutosaveLogOutModal"},528752:(e,a,t)=>{t.r(a),t.d(a,{AutosaveNewFileAlreadyOpenModal:()=>u});var l=t(411855),s=t(188507),n=t(776250),o=t(946689),i=t(762638),c=t(939863),r=t(662275),m=t(488578),d=t(282688);function u(e){let a=(0,s.wA)();return(0,l.useEffect)(()=>(0,n.sx)("New Autosave File Already Open Modal Shown")),l.createElement(m.aF,{size:360,tintedModalBackground:!0},l.createElement("div",{className:d.DD},l.createElement(c.Tx,{id:"autosave.file_already_open_modal.title"})),l.createElement("div",{className:d.rf},l.createElement(c.Tx,{id:"autosave.file_already_open_modal.body",fileName:l.createElement("span",{className:i.cx.fontSemiBold.$},e.file.name)})),l.createElement("div",{className:d.Vw},l.createElement(o.nR,{onClick:()=>a(r.Ce())},l.createElement(c.Tx,{id:"general.ok"}))))}u.displayName="AutosaveNewFileAlreadyOpenModal"}}]);

//# debugId=22eb51e7-c782-5bef-a346-7b41dbc38d14

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/ab597c84e72d31ed91ed828ed7bb8885fbb22dbd/autosave-8e9542bde6560da9.min.js.map