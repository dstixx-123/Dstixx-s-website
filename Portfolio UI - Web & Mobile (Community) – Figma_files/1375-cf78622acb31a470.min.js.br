"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="8145e80c-e1ad-5a4f-a211-90cb041adc18")}catch(e){}}();
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[1375],{736916:(e,t,a)=>{a.d(t,{EH:()=>u,MC:()=>s,ji:()=>c,l0:()=>l,xo:()=>o,zp:()=>i});var n=a(374626),r=a(582947);let i="user_has_generated_ai_summary",l="has_dismissed_summarization_nudge",o=(0,r.r1)(i),s=(0,r.r1)(l),c=(0,n.E3)("last_saw_summarization_nudge","0"),u=(0,n.E3)("seen_summarization_nudge_count",0)},89586:(e,t,a)=>{a.d(t,{jW:()=>F,cI:()=>R,ex:()=>z});var n=a(411855),r=a(188507),i=a(767129),l=a(841368),o=a(776250),s=a(153234),c=a(347082),u=a(27087),d=a(268537),m=a(493323),_=a(574176),p=a(46481),g=a(939863),f=a(392592),h=a(677664),b=a(798099),v=a(356390),y=a(852800),E=a(662531),k=a(318812),w=a(29680),S=a(498606),I=a(279145),T=a(726864),C=a(395701),A=a(862442),N=a(843495),O=a(457630),x=a(720488),q=a(7959),U=a(82131),j=a(258376),P=a(951912);function R(e){return n.createElement(c.p,{name:"live_object_panel"},n.createElement(q.Zk,null,n.createElement(q.fI,{className:U.LO},n.createElement(q.xw,null,n.createElement("div",{className:"live_object_panel--title--9VTOA"},n.createElement(_.B,{svg:P.A}),n.createElement(g.Tx,{id:"fullscreen.live_object_panel.live_object"}))),n.createElement(L,{pasteSources:e.pasteSources,recordingKey:e.recordingKey}))))}async function M(e,t){for(let a=0;a<t;a++)try{let t=await u.Ay.post(e,void 0,{responseType:"arraybuffer"});return new Uint8Array(t.data)}catch(e){console.error(e)}throw Error(`Failed to download bytes from ${e}`)}async function z(e,t,a){try{let e=[];for(let n of t)(0,o.sx)("update_live_object",{...n}),n.srcFile?(e.push(M(`/api/file_proxy/file/${n.srcFile}/canvas?nodes_to_extract=${n.srcNode}&fv=${a}`,2).then(e=>{E.l7.user("update-live-object-remote",()=>y.glU.updateLiveObject(e,n.nodeId,n.srcNode,n.srcFile))})),await Promise.all(e)):E.l7.user("update-live-object-local",()=>y.glU.updateLiveObject(new Uint8Array,n.nodeId,n.srcNode,""))}catch(t){e(f.F.enqueue({message:(0,g.t)("fullscreen.live_object_panel.live_update_error"),error:!0}))}v.Y5.triggerAction("commit"),e(f.F.enqueue({message:(0,g.t)("fullscreen.live_object_panel.live_update_success")}))}function F(e){let t=(0,r.wA)(),a=(0,w.eY)(),i=function(){let e=(0,A.Z)("outline_navigate"),t=(0,T.Yk)();return n.useCallback(a=>{N.wr(),N.Dh([a]);let n=v.Y5.getViewportInfo();e((0,O.QZ)({nodeId:a,alwaysPan:!0,viewportRect:C.r.fromOriginAndSize(n.x,n.y,n.width,n.height-n.y-t)}))},[t,e])}(),{pasteSources:l,liveUpdate:o,isLiveUpdating:c}=e,u=(0,r.d4)(e=>e.mirror.selectionProperties.resettableInstanceOverrides),m=(0,r.d4)(e=>e.mirror.appModel.keyboardShortcuts),_=!1;if(u){if(u.bubbledInstanceOverrides)_=!0;else for(let e of Object.values(u.selectionOverrides))if(e){_=!0;break}}return n.createElement(n.Fragment,null,n.createElement(d.W.Option,{onClick:()=>{if(1!==l.length)return;let e=l[0];e.srcFile?t((0,h.RK)({rawInput:`${window.location.origin}/file/${e.srcFile}?node-id=${e.srcNode}`})):i(e.srcNode)},disabled:1!==l.length,recordingKey:s.Pt(e,"goToOriginal"),key:"goToOriginal"},n.createElement(g.Tx,{id:"fullscreen.live_object_panel.go_to_original"})),n.createElement(d.W.Option,{disabled:!_,onClick:()=>{let e=l.map(e=>e.nodeId);E.l7.user("reset-instance-overrides",()=>y.glU.resetSymbolOverridesForNodes(e,y.YnC.OVERRIDES_FOR_LAYER_AND_SUBLAYERS)),v.Y5.commit()},recordingKey:s.Pt(e,"resetAllChanges"),key:"resetAllChanges"},n.createElement(g.Tx,{id:"fullscreen.live_object_panel.reset_all_changes"})),n.createElement(d.W.Option,{onClick:()=>o(l),disabled:c,recordingKey:s.Pt(e,"updateLiveObject-menu"),key:"updateLiveObject"},n.createElement(g.Tx,{id:"fullscreen.live_object_panel.update_live_object"})),n.createElement(d.W.Separator,{key:"divider"}),n.createElement(d.W.Option,{className:"live_object_panel--menuOption--MSmCN",onClick:()=>{let e=[];for(let t of l){let n=a.get(t.nodeId);n&&(e.push(t.nodeId),n.clearPasteSource())}E.l7.user("detach-instances",()=>y.glU.detachInstances(e)),v.Y5.commit()},recordingKey:s.Pt(e,"detachFromLive"),key:"detachFromLive"},n.createElement(g.Tx,{id:"fullscreen.live_object_panel.detach_from_live"}),n.createElement("span",{className:"live_object_panel--shortcut--hBzZv"},(0,I.c1)(m,"detach-instance"))))}function L(e){let{pasteSources:t}=e,a=(0,r.wA)(),{showing:o,toggle:c}=(0,k.B)("live-object-dropdown"),u=(0,r.d4)(e=>e.fileVersion),[d,_]=n.useState(!1),f=n.useRef(null),h=s.Pt(e,"updateLiveObject"),v=s.Pt(e,"liveObjectMenu"),y=n.useCallback(async e=>{_(!0),await z(a,e,u),_(!1)},[u,a]);return n.createElement(n.Fragment,null,d?n.createElement(m.kt,{className:"live_object_panel--spinner--iQ62Q",altIcon:j.A}):n.createElement(i.K,{as:"button",onClick:()=>y(t),onMouseDown:b.dG,"data-tooltip-type":S.Ib.TEXT,"data-tooltip":(0,g.t)("fullscreen.live_object_panel.update_live_object"),"aria-label":(0,g.t)("fullscreen.live_object_panel.update_live_object"),recordingKey:h},n.createElement(p.U,{fix_me_removeThisPropAndProvideUI3Icon:!0,svg:j.A})),n.createElement("div",{ref:f},n.createElement(q.YW,{selected:o,onClick:c,onMouseDown:b.dG,className:"live_object_panel--iconButton--vrVs2","data-tooltip-type":S.Ib.TEXT,"data-tooltip":(0,g.t)("fullscreen.live_object_panel.live_object_options"),recordingKey:v},n.createElement(l.J,null))),o&&(f.current?n.createElement(x.Cf,{targetRect:f.current.getBoundingClientRect(),propagateCloseClick:!0},n.createElement(F,{pasteSources:t,liveUpdate:y,isLiveUpdating:d,recordingKey:v})):null))}},468829:(e,t,a)=>{a.d(t,{w:()=>d});var n=a(411855),r=a(629019),i=a.n(r),l=a(966712),o=a(762638),s=a(939863),c=a(422237),u=a(530244);let d=(0,c.ex)("ai_features_tooltip",function(){return(0,l.kc)().figjam_synthesize_handbrake?n.createElement("div",{className:o.cx.flex.flexColumn.justifyCenter.$},n.createElement("p",{className:i()(u.Qq)},(0,s.t)("whiteboard.inline_menu.ai_quick_actions_disabled_header")),n.createElement("p",{className:i()(u.Qq)},(0,s.t)("whiteboard.inline_menu.ai_quick_actions_disabled_try_again_later"))):n.createElement("span",null,(0,s.t)("whiteboard.inline_menu.ai_quick_actions_button_text"))})},632084:(e,t,a)=>{a.d(t,{zi:()=>g,Gq:()=>f,MS:()=>h,bM:()=>b,ON:()=>y,ep:()=>E,b7:()=>p,SU:()=>c});var n=a(987918),r=a(939863),i=a(852800),l=(e=>(e.HEART="heart",e.STAR="star",e.PLUS_ONE="+1",e.THUMBS_UP="thumbs up",e.THUMBS_DOWN="thumbs down",e.QUESTION="question",e.PROFILE="profile",e.DOT="dot",e.OTHER="other",e))(l||{});let o={heart:{type:"heart",nodeNameOnCanvas:"Heart"},star:{type:"star",nodeNameOnCanvas:"Star"},"+1":{type:"+1",nodeNameOnCanvas:"+1"},"thumbs up":{type:"thumbs up",nodeNameOnCanvas:"Thumbs up"},"thumbs down":{type:"thumbs down",nodeNameOnCanvas:"Thumbs down"},question:{type:"question",nodeNameOnCanvas:"Question"},profile:{type:"profile",nodeNameOnCanvas:"Profile"},dot:{type:"dot",nodeNameOnCanvas:"Dot"},other:{type:"other",nodeNameOnCanvas:"Other"}},s=[i.Z6A.STICKY,i.Z6A.TEXT,i.Z6A.SHAPE_WITH_TEXT];function c(e){return e?e.textSublayer?e.textSublayer.textContent:e.textContent?e.textContent:null:null}let u=(e,t)=>e?c(e)||(e.name?e.name:null):null,d=e=>!!["STICKY","TEXT","SHAPE_WITH_TEXT"].includes(e.type),m=(e,t,a)=>{if(!d(e))return null;let n=a[e.guid],r=u(e,t);if(!r)return null;let i={t:r,bounds:e.absoluteRenderBounds,id:e.guid,type:e.type};return n&&(i.stamps=n),i},_=e=>{let t=i.DV9.getStampsOnNodes(e),a=Object.fromEntries(t),n={};for(let[e,r]of t)n[e]=Object.fromEntries(a[e]);return n};function p(e){let t=function(e){let t=i.glU.searchForNodesInSelection(s),a=[];for(let n of t){let t=e.get(n);t&&a.push(t)}return a.filter(e=>d(e))}(e),a=_(t.map(e=>e.guid)),n=[];for(let r of t){let t=m(r,e,a);t&&n.push(t)}return{v:1,data:n}}function g(e){let t=function(e){let t=i.glU.getStickyThreadsFromSelection(),a=[];for(let n of t){let t=!1,r={id:"",text:""};for(let a of n){let n=e.get(a);if(n&&"STICKY"===n.type){let e=n.textSublayer&&n.textSublayer.textContent||"";if(t)r.id=r.id?`${r.id}|${a}`:a,e&&(r.text=r.text?`${r.text}|${e}`:e);else{if(t=!0,!e)continue;r.id=n.guid,r.text=e;continue}}}r.text&&a.push(r)}return a}(e),a=JSON.stringify(t).length;return{v:1,data:t,characterCount:a}}function f(){let e=i.glU.searchForNodesInSelection([i.Z6A.STICKY]),t=i.DV9.getStickyClustersByAuthor(e),a=[];for(let e of t)a.push({clusterName:e[0],messages:e[1]});return a}function h(){let e=i.glU.searchForNodesInSelection([i.Z6A.STICKY]),t=i.DV9.getStickyClusterByColor(e),a=[];for(let e of t)a.push({clusterName:"",messages:e[1]});return a}function b(){let e=i.glU.searchForNodesInSelection([i.Z6A.STICKY]),t=i.DV9.getStickyClusterByStampCount(e),a=[];for(let e of t)a.push({clusterName:e[0],messages:e[1]});return a.sort((e,t)=>parseInt(t.clusterName)-parseInt(e.clusterName)),a}let v=e=>{let t=i.DV9.getStickyClusterByStampType(e),a=new Map;return t.forEach((e,t)=>{let n=function(e){let t=Object.values(o).find(t=>t.nodeNameOnCanvas===e);return t?t.type:"other"}(t),r=a.get(n)??[];r=r.concat(e),a.set(n,r)}),a};function y(){let e=v(i.glU.searchForNodesInSelection([i.Z6A.STICKY])),t=[];for(let a of e)t.push({clusterName:function(e){switch(e){case l.HEART:return(0,r.t)("whiteboard.clustering.heart_stamp_cluster");case l.DOT:return(0,r.t)("whiteboard.clustering.dot_stamp_cluster");case l.PLUS_ONE:return(0,r.t)("whiteboard.clustering.plus_one_stamp_cluster");case l.PROFILE:return(0,r.t)("whiteboard.clustering.face_stamp_cluster");case l.QUESTION:return(0,r.t)("whiteboard.clustering.question_mark_stamp_cluster");case l.STAR:return(0,r.t)("whiteboard.clustering.star_stamp_cluster");case l.THUMBS_DOWN:return(0,r.t)("whiteboard.clustering.thumbs_down_stamp_cluster");case l.THUMBS_UP:return(0,r.t)("whiteboard.clustering.thumbs_up_stamp_cluster");case l.OTHER:default:return(0,r.t)("whiteboard.clustering.other_stamp_cluster")}}(a[0]),messages:a[1]});return t}function E(e,t){let a=e.get(t);if(!a||!a.isDiagramNode)return null;let r=c(a);if(!r)return null;let i=[],l=a.diagramParentId;for(;l&&l!==n.AD;){let t=e.get(l);if(!t)break;let a=c(t);a&&i.push(a),l=t.diagramParentId}i.reverse();let o=[];for(let t of a.diagramChildIds){let a=c(e.get(t));a&&o.push(a)}return{selectedNode:r,parentHierarchy:i,children:[],excludedSuggestions:o}}},47750:(e,t,a)=>{a.d(t,{J:()=>O,f:()=>N});var n=a(411855),r=a(188507),i=a(939683),l=a(966712),o=a(374626),s=a(395900),c=a(559036),u=a(825871),d=a(939863),m=a(574724),_=a(378260),p=a(106757),g=a(852800),f=a(662531),h=a(862442),b=a(843495),v=a(341860),y=a(457630),E=a(335682),k=a(247014),w=a(951840),S=a(435898),I=a(342824),T=a(88596),C=a(632084);let A=e=>({...e,width:e.w,height:e.h});function N(){let e=n.useRef((0,d.t)("whiteboard.ai_cluster.loading_section_base")),t=n.useMemo(()=>new v.qo,[]),{Sprig:a}=(0,c.A)(),[N,O]=n.useState(!1),x=(0,i.am)(),q=n.useRef(),U=(0,h.Z)("figjam_summary_navigate"),j=(0,I.um)(),P=(0,o.md)(_._s),R=(0,o.md)(E.As),M=(0,o.md)(p.kS),z=(0,o.md)(E.yM),F=(0,o.md)(E.ze),L=(0,r.d4)(e=>e.multiplayer.allUsers.length),B={orgId:P,teamId:R||null,fileKey:F,userId:M||null,trackingSessionId:(0,u.f)()},D=n.useCallback(e=>{let a=t.get(e);(null==a?void 0:a.isAlive())&&f.l7.system("remove-cluster-placeholder",()=>g.Hur.removePlaceholder(e)),q.current&&(clearInterval(q.current),q.current=void 0)},[q,t]);return{clusterCanvasSelection:()=>{let n=new s.jk(T.Ux.TIME_TAKEN_TO_COMPLETE,{});n.start(),O(e=>!e);let r=g.glU.getSelectionBounds(),{v:i,data:o,characterCount:c}=(0,C.zi)(t),u=e.current+".",d=f.l7.system("create-cluster-placeholder",()=>{let e=g.Hur.createPlaceholder(r);return b.i(e,u),e});U((0,y.QZ)({nodeId:d,alwaysPan:!1})),q.current=setInterval(()=>{u.length===e.current.length+3?u=e.current+".":u+=".",f.l7.system("update-cluster-placeholder-text",()=>b.i(d,u))},1e3),m.Ay.figjam.cluster({v:i,data:o,tokenCount:c/4},B).then(e=>{let i=t.get(d),s=null==i?void 0:i.containingCanvas;if(!(null==i?void 0:i.isAlive())||!s)return;let u=null==i?void 0:i.absoluteRenderBounds,m=u?A(u):r;D(d);let[_,p]=f.l7.user("create-and-place-clusters",()=>g.Hur.createAndPlaceClusters(e.clusters,m,s,!1));a("track",S.l0),O(!1);let h=n.stop();h&&x(T.Ux.TIME_TAKEN_TO_COMPLETE,{elapsed_ms:h},{forwardToDatadog:!0}),x("ai_sticky_clusters_created",{request_id:e.requestUuid,nodes_clustered:o.map(e=>e.id.split("|")).flat(),num_characters_input:c,success:!0,output_section_node_ids:p,output_sticky_node_ids:_,failure_reason:""}),(0,l.kc)().workspace_activity_write&&F&&z&&w.i.recordActivity({activityUnitType:k.qj.FILE_COLLABORATION,fileKey:F,collaborationType:k.Uz.AI_CLUSTER,numPeopleInFile:L})}).catch(e=>{let t;D(d);let a=(0,I.E$)(e,I.ez.CLUSTER);x("ai_sticky_clusters_created",{nodes_clustered:o.map(e=>e.id.split("|")).flat(),num_characters_input:c,success:!1,failure_reason:a.message}),"figjam_cluster_out_of_date"===a.type&&(t={type:I.tE.Reload}),j(a.message,I.ez.CLUSTER,t)})},requestIsPending:N}}function O(e,t=!1){let a=n.useMemo(()=>new v.qo,[]),[r,i]=n.useState(!1),l=n.useRef(),o=(0,h.Z)("figjam_local_cluster_navigate"),s=n.useCallback(e=>{let t=a.get(e);(null==t?void 0:t.isAlive())&&f.l7.system("remove-cluster-placeholder",()=>g.Hur.removePlaceholder(e)),l.current&&(clearInterval(l.current),l.current=void 0)},[l,a]);return{cluster:()=>{i(e=>!e);let n=g.glU.getSelectionBounds(),r=e(),l=f.l7.system("create-cluster-placeholder",()=>g.Hur.createPlaceholder(n));o((0,y.QZ)({nodeId:l,alwaysPan:!1}));let c=a.get(l),u=null==c?void 0:c.containingCanvas;if(!(null==c?void 0:c.isAlive())||!u)return;let d=null==c?void 0:c.absoluteRenderBounds,m=d?A(d):n;s(l),f.l7.system("create-and-place-clusters",()=>g.Hur.createAndPlaceClusters(r,m,u,t)),i(!1)},requestIsPending:r}}},230646:(e,t,a)=>{a.d(t,{CI:()=>u,QP:()=>o,V:()=>l,cF:()=>s,v1:()=>c});var n=a(188507),r=a(966712),i=a(211041);function l(){return!!(0,n.d4)(e=>e.mirror.selectionProperties.whiteboardStickyAIControlsShown)}function o(){let e=(0,n.d4)(e=>e.mirror.selectionProperties.whiteboardMindmapAIControlsShown);return!!((0,r.kc)().figjam_mindmaps_gen_from_node&&e)}function s(){return!!(0,n.d4)(e=>e.mirror.selectionProperties.whiteboardSelectionCanSummarize)}function c(){return!!(0,n.d4)(e=>e.mirror.selectionProperties.whiteboardSelectionCanCluster)}function u(){let e=(0,n.d4)(e=>e.mirror.selectionProperties.whiteboardSelectionCanShowAiOnboardingBadge),t=(0,i.tG)();return!!(e&&t)}},477173:(e,t,a)=>{a.d(t,{ss:()=>P});var n=a(411855),r=a(188507),i=a(776250),l=a(939683),o=a(966712),s=a(374626),c=a(395900),u=a(559036),d=a(825871),m=a(743282),_=a(931828),p=a(574724),g=a(378260),f=a(106757),h=a(852800),b=a(662531),v=a(736916),y=a(769977),E=a(862442),k=a(341860),w=a(457630),S=a(335682),I=a(247014),T=a(951840),C=a(479296),A=a(435898),N=a(342824),O=a(88596),x=a(632084);class q{static generateLocalRequestId(){return(0,m.g)()}}let U=(0,C.D)((e,t,a)=>{let n=b.l7.user("insert-ai-summary-node",()=>h.glU.insertAISummaryInCanvas(t,a)),r=e.get(n);return r&&(b.l7.user("set-ai-summary-timestamp",()=>{(0,y.Gw)(r,new Date)}),h.glU.triggerAction("commit",{})),r});async function j({v:e,canvasData:t,nodePosition:a,loadingNodeGuid:n,showErrorBell:r,trackSummaryRequested:l,trackSummaryCreated:o,scene:c,operationTimer:u,source:m}){let E,k;let w={orgId:s.zl.get(g._s),teamId:s.zl.get(S.As)||null,fileKey:s.zl.get(S.ze)||null,userId:s.zl.get(f.kS)||null,trackingSessionId:(0,d.f)()},I=e=>{let t;throw"figjam_summarize_out_of_date"===e.type&&(t={type:N.tE.Reload}),"content_length_limit_exceeded"===e.type&&"DISCOVERY_NUDGE"===m&&(0,i.sx)("ai_summarize_from_nudge_exceeded_token_length_limit",{},{forwardToDatadog:!0}),r(e.message,N.ez.SUMMARIZE,t),Error(N.xQ[N.ez.SUMMARIZE]+e.message)},T=t.map(e=>e.id),C=q.generateLocalRequestId();l(T,t,C);let A=null,x=!1;try{E=(await p.Ay.figjam.streamSummarize({v:e,data:t},w)).pipeThrough((0,p.nU)())}catch(e){I((0,N.E$)(e,N.ez.SUMMARIZE));return}let j=()=>{if(!x){let e=c.get(n);e&&e.isAlive()&&b.l7.system("remove-ai-summary-loading-state",()=>{h.glU.deleteNode(n),x=!0})}},P=()=>{let e=U(c,a,n);return e&&setTimeout(()=>{j()},200),e},R=0;try{for await(let e of new p.c6(E)){k=e;let t=R%5==0;A||(A=await P()),t&&b.l7.system("stream-ai-summary",()=>{A&&(0,y.WN)(A,k)}),R++}}catch(e){I((0,N.E$)(e,N.ez.SUMMARIZE));return}if(b.l7.system("stream-ai-summary",()=>{k&&A&&(0,y.WN)(A,k)}),k){let e=u.stop();e&&(0,i.sx)(O.mr.TIME_TAKEN_TO_COMPLETE,{elapsed_ms:e},{forwardToDatadog:!0}),A&&(_.b({[v.zp]:!0}),o(A.guid,k,C))}k&&A&&h.glU.triggerAction("commit",{})}function P(e,t=!0,a){let[i]=n.useState(new k.qo),[s,d]=n.useState(!1),m=(0,E.Z)("figjam_summary_navigate"),_=(0,N.um)(),{Sprig:p}=(0,u.A)(),g=function(){let e=(0,l.am)();return n.useCallback((t,a,n)=>{let r=(0,O.sh)(a);e(O.mr.REQUEST,{local_summary_id:n,num_characters_input:r,nodes_summarized:t})},[e])}(),f=function(){let e=(0,l.am)(),t=(0,S.q5)(),a=(0,r.d4)(e=>e.multiplayer.allUsers.length),i=n.useRef(a);return i.current=a,n.useCallback((a,n,r)=>{var l;let s={local_summary_id:r,summary_node_id:a,num_characters_output:n.map(e=>"content"in e?e.content.length:0).reduce((e,t)=>e+t,0),num_themes_output:n.filter(e=>"h2"===e.type).length,num_supporting_points_output:n.filter(e=>"li"===e.type).length};e(O.mr.CREATE,s),(0,o.kc)().workspace_activity_write&&(null==(l=null==t?void 0:t.team)?void 0:l.workspaceId)&&T.i.recordActivity({activityUnitType:I.qj.FILE_COLLABORATION,fileKey:t.key,collaborationType:I.Uz.AI_SUMMARY,numPeopleInFile:i.current})},[e,t,i])}();return{summarizeCanvasSelection:async()=>{let n=new c.jk(O.mr.TIME_TAKEN_TO_COMPLETE,{});n.start();let{v:r,data:l}=(0,x.b7)(new k.qo),o=b.l7.user("insert-ai-summary-loading-node",()=>h.glU.insertLoadingSummaryInCanvas(e===h.cfv.BELOW,t)),s=i.get(o);if(!s)return;b.l7.user("insert-ai-summary-loading-node",()=>{s.setWidgetSyncedState("syncedState:loading","true")}),m((0,w.QZ)({nodeId:o,alwaysPan:!1}));let u={x:s.absoluteBoundingBox.x,y:s.absoluteBoundingBox.y};if(l){d(!0);try{await j({v:r,canvasData:l,nodePosition:u,loadingNodeGuid:o,showErrorBell:_,trackSummaryRequested:g,trackSummaryCreated:f,scene:i,operationTimer:n,source:a})}catch(e){i.get(o)&&h.glU.deleteNode(o)}finally{p("track",A.AM),d(!1)}}},requestIsPending:s}}},773912:(e,t,a)=>{a.d(t,{s_:()=>ei,nG:()=>J,Ay:()=>ee,Bl:()=>et,dA:()=>er});var n=a(411855),r=a(188507),i=a(629019),l=a.n(i),o=a(737947),s=a(966712),c=a(374626),u=a(860601),d=a(743282),m=a(712366),_=a(498480),p=a(268537),g=a(210954),f=a(574176),h=a(939863),b=a(931828),v=a(672517),y=a(582947),E=a(662531),k=a(498606),w=a(538697),S=a(468829),I=a(67048),T=a(211041),C=a(47750),A=a(230646),N=a(939683),O=a(395900),x=a(825871),q=a(392592),U=a(934533),j=a(574724),P=a(378260),R=a(106757),M=a(852800),z=a(341860),F=a(335682),L=a(342824),B=a(632084);let D="ai_expand_mindmap";var K=(e=>(e.LOADING="ai-expand-mindmap-loading",e.SUCCESS="ai-expand-mindmap-success",e))(K||{}),$=a(477173),H=a(677859),Q=a(437771),W=a(260378),Y=a(425187),Z=a(266066),G=a(58772),V=a(449802),X=a(62573);let J="https://help.figma.com/hc/articles/16822138920343-Use-AI-tools-in-Figma";var ee=(e=>(e.SUMMARIZE="summarize",e.CLUSTER="cluster",e.GENERATE_IDEAS="generate_ideas",e))(ee||{});let et=(0,y.r1)("used_figjam_ai_quick_actions"),ea="used_figjam_ai_mindmaps_inline_menu",en=(0,y.r1)(ea);function er(){let e=(0,c.md)(Y.f).positionRelativeToSelection,{summarizeCanvasSelection:t}=(0,$.ss)(e,void 0,"INLINE_TOOLBAR"),{clusterCanvasSelection:a}=(0,C.f)(),{expandSelectedMindmapNode:i}=function(){let e=(0,c.md)(P._s),t=(0,c.md)(F.As),a=(0,c.md)(F.ze),i=(0,c.md)(R.kS),l=(0,L.um)(),o=(0,N.am)(),s=(0,r.wA)(),u={orgId:e,teamId:t||null,fileKey:a,userId:i||null,trackingSessionId:(0,x.f)()},d=n.useCallback(()=>s(q.F.enqueue({message:(0,h.t)("whiteboard.ai_expand_mindmap.generic_error")})),[s]),m=e=>{for(let t of e)E.l7.user("expand-figjam-ai-mindmap",()=>{M.glU.deleteNode(t)})},_=(e,t,a)=>{let n=(0,B.ep)(new z.qo,e);if(!n){d(),o(D,{success:!1,failure_reason:"Failed to get input data"});return}s(q.F.dequeue({matchType:"ai-expand-mindmap-success"})),s(q.F.enqueue({message:(0,h.t)("whiteboard.ai_modal.streaming"),icon:U.zX.SPINNER,type:"ai-expand-mindmap-loading",timeoutOverride:1/0})),j.Ay.figjam.updateVisual({inputData:n,updateType:{visualType:"mindmap",updateMode:"generate_ideas"}},u).then(n=>{a&&m(a);let r=E.l7.user("expand-figjam-ai-mindmap",()=>M.$mk.expandWithFigjamAiMindmapNodes(n,e)),i=t.stop();r.length?(s(q.F.enqueue({message:(0,h.t)("whiteboard.ai_expand_mindmap.generation_success"),type:"ai-expand-mindmap-success",button:{text:(0,h.t)("whiteboard.ai_expand_mindmap.retry"),action:()=>{let t=new O.jk(D,{});return t.start(),_(e,t,r),!1}}})),o(D,{request_id:n.requestId,success:!0,failure_reason:"",num_nodes_generated:r.length,elapsed_ms:i})):(d(),o(D,{request_id:n.requestId,success:!1,failure_reason:"No nodes generated",elapsed_ms:i}))}).catch(e=>{let a=t.stop(),n=(0,L.E$)(e,L.ez.GENERATE);l(n.message,L.ez.GENERATE),o(D,{success:!1,failure_reason:n.message,elapsed_ms:a})}).finally(()=>{s(q.F.dequeue({matchType:"ai-expand-mindmap-loading"}))})};return{expandSelectedMindmapNode:()=>{let e=new O.jk(D,{});e.start();let t=M.wzW.getSingleSelectedDiagramNodeId(),a=function(e,t){let a=e.get(t);if(a){if((0,B.SU)(a))return t;{if(!a.diagramParentId)return;let t=e.get(a.diagramParentId);return(0,B.SU)(t)?a.diagramParentId:void 0}}}(new z.qo,t);if(!a){d(),o(D,{success:!1,failure_reason:"Failed to get selected node"});return}_(a,e)}}}();return e=>{let n=u.lQ,r="";if(e){switch(e.type){case"summarize":n=t,r="ai-quick-action-summarize";break;case"cluster":n=a,r="ai-quick-action-cluster";break;case"generate_ideas":n=i,r="ai-quick-action-generate-ideas"}E.l7.user(r,n)}}}function ei(){var e;let t=(0,d.g)(),a=er(),r=(0,s.kc)().figjam_synthesize_handbrake,[i,l]=n.useState(!1),c=[...function(){let e=(0,A.QP)(),t=[];return e&&t.push({type:"generate_ideas",enabled:e}),t}()];return n.createElement(Q.Fn,{value:void 0,overrideMenuOpenState:{isOpenOverride:i,setIsOpenOverride:l},onChange:a,renderButton:({onClick:e,onKeyDown:a,ref:i})=>n.createElement(el,{onClick:e,onKeyDown:a,buttonRef:i,ariaWrapperId:t,disabled:!!r,trackingProperties:{text:"figjam ai"},dropdownMenuOptions:c}),options:c,renderOption:es,OptionWrapper:(e=(0,h.t)("whiteboard.inline_menu.ai_quick_actions_dropdown_options_aria_label"),function({children:a}){return n.createElement("div",{className:"ai_quick_actions_control--flexColumn--kgAdX","aria-label":e,id:t,role:"listbox",tabIndex:-1,"data-fullscreen-intercept":!0},a)}),responsivePositionY:{aboveTargetPositionY:(e,t,a)=>(0,W.T1)(e,t,a+-48),belowTargetPositionY:(e,t,a)=>(0,W.DH)(e,t,a+-48)},positionX:e=>e.x,popoverClassName:"ai_quick_actions_control--popover--BNsqs",additionalContentsTop:function({closeMenu:e}){return n.createElement("div",{className:"ai_quick_actions_control--dropdownHeaderContainer--ifOPr",onClick:e,role:"button",tabIndex:0},n.createElement("div",{className:"ai_quick_actions_control--dropdownHeaderTitle--Cqg8n"},n.createElement(h.Tx,{id:"whiteboard.inline_menu.ai_quick_actions_header_text"})),n.createElement("div",{className:"ai_quick_actions_control--badgeContainer--kBpYM"},n.createElement(I.G,{location:"INLINE_TOOLBAR",overrideText:(0,h.t)("whiteboard.inline_menu.ai_quick_actions_beta_badge_text")})))}({closeMenu:()=>l(!1)}),additionalOptions:eo,additionalOptionOnChange:()=>{(0,m.Lf)(J)||o.Ay.unsafeRedirect(J,"_blank")}})}let el=(0,v.tf)(function({onClick:e,onKeyDown:t,buttonRef:a,ariaWrapperId:i,disabled:o,dropdownMenuOptions:d}){let[m,p]=n.useState(0),{shouldShowBadge:g,setUserFlagsCallback:y}=function(e){var t;let a=(0,r.wA)(),i=(t=["generate_ideas"],!!e.find(e=>e&&t.includes(e.type)));return{shouldShowBadge:function(e){let t=(0,T.tG)(),a=(0,c.md)(en).data;return!!((0,s.kc)().figjam_mindmaps_gen_from_node&&t&&!a&&e)}(i),setUserFlagsCallback:n.useCallback(()=>{i&&a(b.b({[ea]:!0}))},[i,a])}}(d);return n.createElement(H.$n,{tooltip:S.w,tooltipType:k.Ib.SPECIAL,onClick:o?u.lQ:()=>{e(),y()},disabled:o,onKeyDown:t,ariaControls:i,ref:a,recordingKey:"toolbarAIQuickActionsDropdownButton",testId:"toolbarAIQuickActionsDropdownButton",caret:"down",role:"combobox",ariaLabel:(0,h.t)("whiteboard.inline_menu.ai_quick_actions_button_aria_label"),buttonStyle:{width:g?48+m+8:48},buttonChildrenStyle:{justifyContent:"initial",width:"initial"}},n.createElement("div",{className:l()({"ai_quick_actions_control--withBadge--z88DK":g})},n.createElement("div",{className:"ai_quick_actions_control--buttonIconContainer--pBGdR"},n.createElement(f.B,{svg:Z.A,className:l()("ai_quick_actions_control--svgIcon--XDs5m",{"ai_quick_actions_control--svgIconDisabled--u4WwB":o})})),g&&n.createElement(v.fu,{name:"ai_quick_actions_onboarding_badge"},n.createElement("div",{ref:e=>{p((null==e?void 0:e.offsetWidth)||m)}},n.createElement(_.Ex,{text:(0,h.t)("whiteboard.inline_menu.ai_quick_actions_onboarding_badge_2"),color:_.zE.FIGJAM,size:_.vj.SMALL,className:"ai_quick_actions_control--onboardingBadge---sKJz"})))))});function eo(e){return n.createElement(n.Fragment,null,n.createElement(p.W.Separator,{key:"menu-separator-token"}),n.createElement("div",{className:"ai_quick_actions_control--dropdownFooterContainer--1d8mD"},n.createElement("span",null,n.createElement("span",{className:"ai_quick_actions_control--dropdownFooterDisclaimer--UVXvJ"},`${(0,h.t)("whiteboard.inline_menu.ai_quick_actions_dropdown_disclaimer")} `),n.createElement(g.N,{className:l()("ai_quick_actions_control--dropdownFooterCta--hi6Ik",{"ai_quick_actions_control--dropdownFooterCtaIsFocused--2OdM8":e}),href:J,target:"_blank",trusted:!0},n.createElement(h.Tx,{id:"whiteboard.inline_menu.ai_quick_actions_dropdown_disclaimer_cta"})))))}let es=e=>{let{value:t,onClick:a,id:r,isFocused:i}=e;if(!t)return null;let{type:l,enabled:o}=t,{displayText:s,svgSrc:c,disabledTooltipText:u}=function(e){switch(e){case"summarize":return{displayText:(0,h.t)("whiteboard.inline_menu.ai_quick_actions_summarize_button"),svgSrc:X.A,disabledTooltipText:(0,h.t)("whiteboard.inline_menu.ai_quick_actions_summarize_disabled_tooltip",{minSelectedStickies:2})};case"cluster":return{displayText:(0,h.t)("whiteboard.inline_menu.ai_quick_actions_sort_stickies_button"),svgSrc:V.A,disabledTooltipText:(0,h.t)("whiteboard.inline_menu.ai_quick_actions_sort_stickies_disabled_tooltip",{minSelectedStickies:2})};case"generate_ideas":return{displayText:(0,h.t)("whiteboard.inline_menu.ai_quick_actions_generate_ideas_button"),svgSrc:G.A,disabledTooltipText:(0,h.t)("whiteboard.inline_menu.ai_quick_actions_generate_ideas_disabled_tooltip")}}}(l),d="generate_ideas"===l?"generate ideas":"other ai action";return n.createElement(ec,{key:`${l}-menu-option`,id:r,type:l,displayText:s,svgSrc:c,disabledTooltipText:u,disabled:!o,onClick:a,isFocused:i,trackingProperties:{text:d}})},ec=(0,v.tf)(function({id:e,type:t,displayText:a,svgSrc:r,disabledTooltipText:i,disabled:o,onClick:s,isFocused:c}){return n.createElement("div",{id:e,className:l()("ai_quick_actions_control--optionContainer--pbhnv",{"ai_quick_actions_control--optionContainerDisabled--Sxua-":o,"ai_quick_actions_control--optionContainerIsFocused--AD1hq":c}),"aria-label":a,"aria-selected":"false",role:"option",tabIndex:-1,"data-tooltip-type":k.Ib.TEXT,"data-tooltip":o?i:"","data-tooltip-tip-align-left":!0,"data-tooltip-show-right":!0,"data-tooltip-offset-x":6},n.createElement(w.c$,{disabled:o,recordingKey:`aiQuickActionsOption-${t}`,"data-testid":`aiQuickActionsOption-${t}`,dataTestId:`aiQuickActionsOption-${t}`,key:`option-${t}`,value:t,height:32,fullWidth:!0,svg:r,formattedValue:a,additionalStylesClassName:void 0,selected:!1,onMouseUp:o?u.lQ:s,style:{marginLeft:8},ignoreCheck:!0}))})}}]);

//# debugId=8145e80c-e1ad-5a4f-a211-90cb041adc18

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/340f69cde40309d70fb968d6c3d9dc476f71f483/1375-cf78622acb31a470.min.js.map